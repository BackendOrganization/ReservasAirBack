openapi: 3.0.0
info:
  title: Reservations API
  description: API for managing reservations, payments, and flights.
  version: 1.0.1
servers:
  - url: https://reservasairback-production.up.railway.app/

tags:
  - name: Seats
    description: Endpoints for seat management
  - name: Reservations
    description: Endpoints for reservation management
  - name: Payment
    description: Endpoints for payment management
  - name: Flights
    description: Endpoints for flight management
  - name: FlightsCarts
    description: Endpoints for managing user flight carts

paths:
  /seats/flight/{externalFlightId}:
    get:
      tags: [Seats]
      summary: Get reserved or confirmed seats for a flight
      parameters:
        - name: externalFlightId
          in: path
          required: true
          description: The external ID of the flight
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Reserved and confirmed seats summary
          content:
            application/json:
              schema:
                type: object
                properties:
                  flightId:
                    type: integer
                  airCraftType:
                    type: string
                  occupiedSeats:
                    type: array
                    items:
                      type: integer
                  reservedSeats:
                    type: array
                    items:
                      type: integer
              examples:
                SeatsSummaryExample:
                  summary: Example output
                  value:
                    flightId: 1
                    airCraftType: "E190"
                    occupiedSeats: [11,12,18,19,20]
                    reservedSeats: [13,14,15]
        '400':
          description: Missing externalFlightId
        '500':
          description: Error getting seats

  # --- reservation ---
  
  /reservation/book/{externalFlightId}/{externalUserId}:
    post:
      tags: [Reservations]
      summary: Book a seat for a specific flight
      parameters:
        - name: externalFlightId
          in: path
          required: true
          description: The external ID of the flight
          schema:
            type: integer
            format: int64
        - name: externalUserId
          in: path
          required: true
          description: The external ID of the user
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                seatIds:
                  type: array
                  items:
                    type: integer
                    format: int64
              required:
                - seatIds
            examples:
              CreateReservation:
                summary: Example request body
                value:
                  seatIds: [18, 19, 20]
      responses:
        '201':
          description: Reservation created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
              examples:
                ReservationCreated:
                  summary: Reservation created message
                  value:
                    message: "Reservation created successfully"
        '400':
          description: Missing required fields
        '500':
          description: Seat is already reserved

  /reservation/cancel/{reservationId}:
    post:
      tags: [Reservations]
      summary: Cancel a reservation
      parameters:
        - name: reservationId
          in: path
          required: true
          description: The ID of the reservation
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Reservation cancelled successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
              examples:
                ReservationCancelled:
                  summary: Reservation cancelled message
                  value:
                    message: "Reservation cancelled successfully"
        '400':
          description: Missing required fields
        '500':
          description: Error cancelling reservation

  /reservation/user/{externalUserId}:
    get:
      tags: [Reservations]
      summary: Get reservations by external user ID
      parameters:
        - name: externalUserId
          in: path
          required: true
          description: The external ID of the user
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: A list of reservations
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/FullReservation'
              examples:
                FullReservationExample:
                  summary: Example of full reservation response
                  value:
                    - reservationId: 19
                      externalUserId: 1
                      externalFlightId: 1
                      flightData:
                        flightNumber: "E190"
                        origin: {}
                        destination: {}
                        flightDate: "2025-09-17"
                        aircraftModel: "Airbus A330-200"
                      seats:
                        - seatId: 18
                          seatNumber: "4B"
                          cabinName: "ECONOMY"
                          price: "400.00"
                        - seatId: 19
                          seatNumber: "5A"
                          cabinName: "ECONOMY"
                          price: "400.00"
                        - seatId: 20
                          seatNumber: "5B"
                          cabinName: "ECONOMY"
                          price: "400.00"
                      totalPrice: 1200
                      status: "CANCELLED"
                      createdAt: "2025-09-15T20:18:19.000Z"
                      updatedAt: "2025-09-15T20:26:13.000Z"
        '400':
          description: Missing required parameter
        '500':
          description: Error fetching reservations

  /reservation/full/{externalUserId}:
    get:
      tags: [Reservations]
      summary: Get full reservations (flight + seat details) for a user
      parameters:
        - name: externalUserId
          in: path
          required: true
          description: The external ID of the user
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Full reservation data
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/FullReservation'
              examples:
                FullReservationsExample:
                  summary: Example full reservations
                  value:
                    - reservationId: 19
                      externalUserId: 1
                      externalFlightId: 1001
                      flightData:
                        aircraft: "E190"
                        origin: {}
                        destination: {}
                        flightDate: "2025-09-17"
                        aircraftModel: "Airbus A330-200"
                      seats:
                        - seatId: 18
                          seatNumber: "4B"
                          category: "ECONOMY"
                          price: "400.00"
                      totalPrice: 400
                      status: "PAID"
                      createdAt: "2025-09-15T20:18:19.000Z"
                      updatedAt: "2025-09-15T20:26:13.000Z"
        '400':
          description: Missing required parameter
        '500':
          description: Error fetching reservations

  # --- PAYMENT ---
  /payment/confirm:
    post:
      tags: [Payment]
      summary: Confirm a payment
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                paymentStatus:
                  $ref: '#/components/schemas/PaymentStatus'
                reservationId:
                  type: integer
                  format: int64
                externalUserId:
                  type: integer
                  format: int64
              required:
                - paymentStatus
                - reservationId
                - externalUserId
            examples:
              ConfirmedPayment:
                summary: Confirmed payment example
                value:
                  paymentStatus: "SUCCESS"
                  reservationId: 15
                  externalUserId: 5
      responses:
        '200':
          description: Payment confirmed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
              examples:
                PaymentConfirmed:
                  summary: Payment confirmed message
                  value:
                    message: "Payment confirmed successfully"
        '400':
          description: Missing required fields or invalid payment status
        '500':
          description: Error confirming payment

  /payment/cancel:
    post:
      tags: [Payment]
      summary: Cancel a payment
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                reservationId:
                  type: integer
                  format: int64
                externalUserId:
                  type: integer
                  format: int64
              required:
                - reservationId
                - externalUserId
            examples:
              CancelPayment:
                summary: Cancel payment example
                value:
                  paymentStatus: "REFUND"
                  reservationId: 11
                  externalUserId: 1
      responses:
        '200':
          description: Payment cancelled successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
              examples:
                PaymentCancelled:
                  summary: Payment cancelled message
                  value:
                    message: "Payment cancelled successfully"
        '400':
          description: Missing required fields
        '500':
          description: Error cancelling payment

  /payment/fail:
    post:
      tags: [Payment]
      summary: Mark payment as failed
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                paymentStatus:
                  $ref: '#/components/schemas/PaymentStatus'
                reservationId:
                  type: integer
                  format: int64
                externalUserId:
                  type: integer
                  format: int64
              required:
                - paymentStatus
                - reservationId
                - externalUserId
            examples:
              FailedPayment:
                summary: Failed payment example
                value:
                  paymentStatus: "FAILED"
                  reservationId: 11
                  externalUserId: 1
      responses:
        '201':
          description: Payment event created and reservation marked as FAILED
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
              examples:
                PaymentFailed:
                  summary: Payment failed message
                  value:
                    message: "Payment event created and reservation marked as FAILED"
        '400':
          description: Missing required payment data
        '500':
          description: Error processing payment event

  /payment/notify/{reservationId}:
    get:
      tags: [Payment]
      summary: Check if payment for a reservation was confirmed (PAID)
      parameters:
        - name: reservationId
          in: path
          required: true
          description: The ID of the reservation to check
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Returns whether the reservation is PAID
          content:
            application/json:
              schema:
                type: object
                properties:
                  reservationId:
                    type: string
                  success:
                    type: boolean
              examples:
                PaidExample:
                  summary: Reservation is PAID
                  value:
                    reservationId: "15"
                    success: true
        '400':
          description: Missing reservationId
        '404':
          description: Reservation not found
        '500':
          description: Database error

  /payment/notify/failed/{reservationId}:
    get:
      tags: [Payment]
      summary: Check if payment for a reservation failed (FAILED)
      parameters:
        - name: reservationId
          in: path
          required: true
          description: The ID of the reservation to check
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Returns whether the reservation is FAILED
          content:
            application/json:
              schema:
                type: object
                properties:
                  reservationId:
                    type: string
                  success:
                    type: boolean
              examples:
                FailedExample:
                  summary: Reservation is FAILED
                  value:
                    reservationId: "11"
                    success: true
        '400':
          description: Missing reservationId
        '404':
          description: Reservation not found
        '500':
          description: Database error

  # --- FLIGHTS ---
  /flights/ingest:
    post:
      tags: [Flights]
      summary: Ingest a new flight
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FlightInput'
            examples:
              ExampleFlight:
                summary: Example flight input
                value:
                  id: 1001
                  flightNumber: "AA1234"
                  origin:
                    code: "EZE"
                    city: "Buenos Aires"
                    time: "14:30"
                  destination:
                    code: "SAME"
                    city: "Mendoza"
                    time: "16:30"
                  aircraft: "A330"
                  aircraftModel: "Airbus A330-200"
                  flighDate: "2026-01-15"
                  duration: "2h 00m"
      responses:
        '201':
          description: Flight inserted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FlightInput'
              examples:
                FlightCreated:
                  summary: Flight created response
                  value:
                    id: 1001
                    flightNumber: "AA1234"
                    origin:
                      code: "EZE"
                      city: "Buenos Aires"
                      time: "14:30"
                    destination:
                      code: "SAME"
                      city: "Mendoza"
                      time: "16:30"
                    aircraft: "A330"
                    aircraftModel: "Airbus A330-200"
                    flighDate: "2026-01-15"
                    duration: "2h 00m"
        '400':
          description: Missing required flight data
        '500':
          description: Error inserting flight

  /flights/{externalFlightId}/cancel:
    post:
      tags: [Flights]
      summary: Cancel reservations for a flight
      parameters:
        - name: externalFlightId
          in: path
          required: true
          description: The external ID of the flight
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Reservations cancelled successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        '400':
          description: Missing externalFlightId
        '500':
          description: Error cancelling reservations

  /flights:
    get:
      tags: [Flights]
      summary: Get all flights
      responses:
        '200':
          description: Flights retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  count:
                    type: integer
                  flights:
                    type: array
                    items:
                      type: object
                      properties:
                        externalFlightId:
                          type: integer
                        freeSeats:
                          type: integer
                        occupiedSeats:
                          type: integer
                        aircraft:
                          type: string
                        origin:
                          $ref: '#/components/schemas/Location'
                        destination:
                          $ref: '#/components/schemas/Location'
                        aircraftModel:
                          type: string
                        flightDate:
                          type: string
                          format: date-time
                        duration:
                          type: string
              examples:
                FlightsExample:
                  summary: Example flights response
                  value:
                    message: "Flights retrieved successfully"
                    count: 2
                    flights:
                      - externalFlightId: 1001
                        freeSeats: 200
                        occupiedSeats: 0
                        aircraft: "A330"
                        origin:
                          city: "Buenos Aires"
                          code: "EZE"
                          time: "14:30"
                        destination:
                          city: "Mendoza"
                          code: "SAME"
                          time: "16:30"
                        aircraftModel: "Airbus A330-200"
                        flightDate: "2026-01-15T00:00:00.000Z"
                        duration: "2h 00m"
                      - externalFlightId: 1002
                        freeSeats: 180
                        occupiedSeats: 0
                        aircraft: "B737"
                        origin:
                          city: "Buenos Aires"
                          code: "EZE"
                          time: "08:15"
                        destination:
                          city: "CÃ³rdoba"
                          code: "COR"
                          time: "09:45"
                        aircraftModel: "Boeing 737-800"
                        flightDate: "2025-12-16T00:00:00.000Z"
                        duration: "1h 30m"

    put:
      tags: [Flights]
      summary: Update any flight fields (status, schedules, etc.)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                flightId:
                  type: string
                  description: aircraftModel / flightId used as identifier
                newStatus:
                  type: string
                  description: New status (e.g. DELAYED, CANCELLED, ONTIME)
                newDepartureAt:
                  type: string
                  format: date-time
                  description: New departure timestamp (ISO)
                newArrivalAt:
                  type: string
                  format: date-time
                  description: New arrival timestamp (ISO)
              required:
                - flightId
            examples:
              UpdateFlightExample:
                summary: Update status and times
                value:
                  flightId: "1001"
                  newStatus: "DELAYED"
                  newDepartureAt: "2025-11-10T16:00:00Z"
                  newArrivalAt: "2025-11-10T18:30:00Z"
      responses:
        '200':
          description: Flight updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  aircraftModel:
                    type: string
              examples:
                FlightUpdated:
                  summary: Flight updated response
                  value:
                    success: true
                    message: "Flight updated successfully"
                    aircraftModel: "1001"
        '400':
          description: Missing required flightId or invalid payload
        '404':
          description: Flight not found
        '500':
          description: Error updating flight

  /flights/{externalFlightId}/delay:
    patch:
      tags: [Flights]
      summary: Mark a flight as DELAYED
      parameters:
        - name: externalFlightId
          in: path
          required: true
          description: The external ID of the flight to mark as delayed
          schema:
            type: integer
            format: int64
      requestBody:
        description: (optional) Payload with additional data if required
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
      responses:
        '200':
          description: Flight status updated to DELAYED
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  aircraftModel:
                    type: string
                  flightStatus:
                    type: string
              examples:
                DelayedExample:
                  summary: Flight delayed response
                  value:
                    success: true
                    message: "Flight status updated to DELAYED"
                    aircraftModel: "1001"
                    flightStatus: "DELAYED"
        '400':
          description: Missing or invalid externalFlightId
        '404':
          description: Flight not found
        '500':
          description: Error updating flight status

  /flights/{externalFlightId}/isCancelled:
    get:
      tags: [Flights]
      summary: Check if a flight is cancelled
      parameters:
        - name: externalFlightId
          in: path
          required: true
          description: The external ID of the flight to check
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Returns whether the flight is cancelled
          content:
            application/json:
              schema:
                type: object
                properties:
                  cancelled:
                    type: boolean
              examples:
                IsCancelledTrue:
                  summary: Flight is cancelled
                  value:
                    cancelled: true
                IsCancelledFalse:
                  summary: Flight is not cancelled
                  value:
                    cancelled: false
        '400':
          description: Missing externalFlightId
        '404':
          description: Flight not found
        '500':
          description: Database error


  # --- FLIGHTS ---
  /flight-cart/add:
    post:
      tags: [FlightsCarts]
      summary: Add a flight to a user's cart
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FlightCartAdd'
            examples:
              AddExample:
                summary: Add flight to cart
                value:
                  externalUserId: 123
                  flights: 1001
      responses:
        '201':
          description: Flight added to cart
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FlightCartResponse'
              examples:
                Added:
                  summary: Added
                  value:
                    success: true
                    message: "Flight added to cart"
                    externalUserId: 123
                    flights: [1001]
        '400':
          description: Missing or invalid payload
        '500':
          description: Error adding flight to cart

  /flight-cart/remove:
    post:
      tags: [FlightsCarts]
      summary: Remove a flight from a user's cart
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FlightCartRemove'
            examples:
              RemoveExample:
                summary: Remove flight from cart
                value:
                  externalUserId: 123
                  flights: 1001
      responses:
        '200':
          description: Flight removed from cart
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FlightCartResponse'
              examples:
                Removed:
                  summary: Removed
                  value:
                    success: true
                    message: "Flight removed from cart"
                    externalUserId: 123
                    flights: []
        '400':
          description: Missing or invalid payload
        '404':
          description: Flight not in cart
        '500':
          description: Error removing flight from cart

  /flight-cart/{externalUserId}:
    get:
      tags: [FlightsCarts]
      summary: Get cart flights for a user
      parameters:
        - name: externalUserId
          in: path
          required: true
          description: The external ID of the user
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Cart retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FlightCart'
              examples:
                CartExample:
                  summary: User cart example
                  value:
                    externalUserId: 123
                    flights: 
                      - externalFlightId: 1001
                        aircraft: "A330"
                        origin:
                          code: "EZE"
                          city: "Buenos Aires"
                          time: "14:30"
                        destination:
                          code: "SAME"
                          city: "Mendoza"
                          time: "16:30"
                        flightDate: "2026-01-15T00:00:00.000Z"
                    flightCount: 1
        '400':
          description: Missing externalUserId
        '500':
          description: Error fetching cart

components:
  schemas:
    Seat:
      type: object
      properties:
        seatId:
          type: integer
          format: int64
        externalFlightId:
          type: integer
          format: int64
        seatNumber:
          type: string
        category:
          type: string
          enum: [ECONOMY, BUSINESS, FIRST]
        status:
          type: string
          enum: [AVAILABLE, RESERVED, CONFIRMED]
        price:
          type: number
          format: float
    Reservation:
      type: object
      properties:
        reservationId:
          type: integer
          format: int64
        externalUserId:
          type: integer
          format: int64
        externalFlightId:
          type: integer
          format: int64
        seatId:
          type: array
          items:
            type: integer
            format: int64
        status:
          type: string
          enum: [PENDING, PAID, CANCELLED, FAILED]
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        totalPrice:
          type: number
          format: float
    FullReservation:
      type: object
      properties:
        reservationId:
          type: integer
        externalUserId:
          type: integer
        externalFlightId:
          type: integer
        flightData:
          type: object
          properties:
            flightNumber:
              type: string
            origin:
              $ref: '#/components/schemas/Location'
            destination:
              $ref: '#/components/schemas/Location'
            flightDate:
              type: string
              format: date
              example: "2025-09-17"
            aircraftModel:
              type: string
              example: "Airbus A330-200"
        seats:
          type: array
          items:
            type: object
            properties:
              seatId:
                type: integer
              seatNumber:
                type: string
              cabinName:
                type: string
              price:
                type: string
        totalPrice:
          type: number
        status:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    PaymentStatus:
      type: string
      enum: [SUCCESS, FAILED, PENDING, REFUND]
    FlightInput:
      type: object
      properties:
        id:
          type: integer
          format: int64
        flightNumber:
          type: string
        origin:
          $ref: '#/components/schemas/Location'
        destination:
          $ref: '#/components/schemas/Location'
        aircraft:
          type: string
        aircraftModel:
          type: string
        flighDate:
          type: string
          format: date
        duration:
          type: string
      required:
        - id
        - flightNumber
        - origin
        - destination
        - aircraft
        - aircraftModel
        - flighDate
        - duration
    Location:
      type: object
      properties:
        code:
          type: string
        city:
          type: string
        time:
          type: string